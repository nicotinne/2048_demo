{"version":3,"sources":["gameOverHandle.js"],"names":["User","require","emitter","db","JSON","parse","cc","sys","localStorage","getItem","Class","extends","Component","properties","edbUsername","EditBox","btnSubmit","Button","lblScore","Label","phaoBong","Node","openGameOver","clickSubmit","users","onLoad","doOpenGameOver","bind","instance","registerEvent","start","checkData","node","on","doSubmit","totalScore","active","countScore","actions","callFunc","delayTime","string","runAction","repeat","sequence","getInfoUserAndPushToArray","user","name","score","push","setItem","stringify","emit"],"mappings":";;;;;;AACA,IAAMA,OAAOC,QAAQ,MAAR,CAAb;AACA,IAAMC,UAAUD,QAAQ,UAAR,CAAhB;AACA,IAAME,KAAKC,KAAKC,KAAL,CAAWC,GAAGC,GAAH,CAAOC,YAAP,CAAoBC,OAApB,CAA4B,OAA5B,CAAX,CAAX;AACAH,GAAGI,KAAH,CAAS;AACLC,aAASL,GAAGM,SADP;;AAGLC,gBAAY;AACRC,qBAAaR,GAAGS,OADR;AAERC,mBAAWV,GAAGW,MAFN;AAGRC,kBAAUZ,GAAGa,KAHL;AAIRC,kBAAUd,GAAGe,IAJL;;AAMRC,sBAAc,IANN;AAORC,qBAAa,IAPL;AAQRC,eAAO;AARC,KAHP;;AAcL;AACAC,UAfK,oBAeK;AACN,aAAKH,YAAL,GAAoB,KAAKI,cAAL,CAAoBC,IAApB,CAAyB,IAAzB,CAApB;AACAzB,gBAAQ0B,QAAR,CAAiBC,aAAjB,CAA+B,eAA/B,EAAgD,KAAKP,YAArD;AACH,KAlBI;AAoBLQ,SApBK,mBAoBI;AACL,aAAKC,SAAL;AACA,aAAKf,SAAL,CAAegB,IAAf,CAAoBC,EAApB,CAAuB,OAAvB,EAAgC,KAAKC,QAArC,EAA+C,IAA/C;AAEH,KAxBI;AA0BLR,kBA1BK,0BA0BUS,UA1BV,EA0BsB;AAAA;;AACvB,aAAKH,IAAL,CAAUI,MAAV,GAAmB,IAAnB;AACA,YAAIC,aAAa,CAAjB;AACA,YAAIC,UAAU,CAAChC,GAAGiC,QAAH,CAAY,YAAM;AAC7BF,0BAAc,CAAd;AACA,gBAAGA,cAAcF,UAAjB,EAA6B;AACzB,sBAAKf,QAAL,CAAcgB,MAAd,GAAuB,IAAvB;AACH;AACJ,SALc,CAAD,EAMd9B,GAAGkC,SAAH,CAAa,IAAb,CANc,EAOdlC,GAAGiC,QAAH,CAAY,YAAM;AAAE,kBAAKrB,QAAL,CAAcuB,MAAd,GAAuBJ,UAAvB;AAAkC,SAAtD,CAPc,CAAd;AAQA,aAAKnB,QAAL,CAAcc,IAAd,CAAmBU,SAAnB,CAA6BpC,GAAGqC,MAAH,CAAUrC,GAAGsC,QAAH,CAAYN,OAAZ,CAAV,EAAgCH,UAAhC,CAA7B;AAEH,KAvCI;AAyCLU,6BAzCK,uCAyCuB;AACxB,YAAIC,OAAO,IAAI9C,IAAJ,EAAX;AACA8C,aAAKC,IAAL,GAAY,KAAKjC,WAAL,CAAiB2B,MAA7B;AACAK,aAAKE,KAAL,GAAa,KAAK9B,QAAL,CAAcuB,MAA3B;AACA,aAAKjB,KAAL,CAAWyB,IAAX,CAAgBH,IAAhB;AACH,KA9CI;AAgDLZ,YAhDK,sBAgDM;AACP,YAAG,KAAKpB,WAAL,CAAiB2B,MAAjB,IAA2B,EAA9B,EAAkC;AAClC,aAAKI,yBAAL;AACA,YAAG,KAAKrB,KAAL,IAAc,IAAjB,EAAuB;AACnBlB,eAAGC,GAAH,CAAOC,YAAP,CAAoB0C,OAApB,CAA4B,OAA5B,EAAqC9C,KAAK+C,SAAL,CAAe,KAAK3B,KAApB,CAArC;AACH;AACD,aAAKV,WAAL,CAAiB2B,MAAjB,GAA0B,EAA1B;AACAvC,gBAAQ0B,QAAR,CAAiBwB,IAAjB,CAAsB,gBAAtB,EAAwC,KAAKpB,IAA7C;AACH,KAxDI;AA0DLD,aA1DK,uBA0DO;AACR,YAAG5B,MAAM,IAAT,EAAe;AACX,iBAAKqB,KAAL,GAAarB,EAAb;AACH;AACJ;AA9DI;AA+DL;AA/DJ","file":"gameOverHandle.js","sourceRoot":"../../../../../assets/Script/Handle","sourcesContent":["\nconst User = require(\"User\");\nconst emitter = require(\"mEmitter\");\nconst db = JSON.parse(cc.sys.localStorage.getItem(\"users\"));\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        edbUsername: cc.EditBox,\n        btnSubmit: cc.Button,\n        lblScore: cc.Label,\n        phaoBong: cc.Node,\n\n        openGameOver: null,\n        clickSubmit: null,\n        users: [],\n    },\n\n    // LIFE-CYCLE CALLBACKS:\n    onLoad () {\n        this.openGameOver = this.doOpenGameOver.bind(this);\n        emitter.instance.registerEvent(\"OPEN_GAMEOVER\", this.openGameOver);\n    },\n\n    start () {\n        this.checkData();\n        this.btnSubmit.node.on(\"click\", this.doSubmit, this);\n        \n    },\n\n    doOpenGameOver(totalScore) {\n        this.node.active = true;\n        let countScore = 0;\n        let actions = [cc.callFunc(() => { \n            countScore += 1;\n            if(countScore == totalScore) {\n                this.phaoBong.active = true;\n            }\n        }),\n        cc.delayTime(0.01),\n        cc.callFunc(() => { this.lblScore.string = countScore})];\n        this.lblScore.node.runAction(cc.repeat(cc.sequence(actions), totalScore));\n        \n    },\n\n    getInfoUserAndPushToArray() {\n        let user = new User();\n        user.name = this.edbUsername.string;\n        user.score = this.lblScore.string;\n        this.users.push(user);\n    },\n\n    doSubmit() {\n        if(this.edbUsername.string == \"\") return;\n        this.getInfoUserAndPushToArray();\n        if(this.users != null) {\n            cc.sys.localStorage.setItem(\"users\", JSON.stringify(this.users));\n        }\n        this.edbUsername.string = \"\";\n        emitter.instance.emit(\"CLOSE_GAMEOVER\", this.node);\n    },\n\n    checkData() {\n        if(db != null) {\n            this.users = db;\n        }\n    },\n    // update (dt) {},\n});\n"]}